@page
@model SaysanPwa.Api.Pages.ReceiptSheet.AddReceiptModel
@{
    ViewBag.Title = "افزودن رسید دریافت";
}
<div class="card">
    <div class="card-header">
        <h2>برگه دریافت</h2>
    </div>
    <div class="card-body">
        <form asp-page="/ReceiptSheet/AddReceipt" method="post">
            <input type="hidden" asp-for="ReceiptSheet.SessionId" />
            <div class="form-group">
                <label>نوع دریافت</label>
                <select asp-for="ReceiptSheet.ReceiptionType" class="form-select">
                    <option value="0">لطفا یک مورد را انتخاب کنید</option>
                    <option value="Typ_DA_MSH">دریافت از مشتری</option>
                    <option value="Typ_DA_TA">دریافت از تامین کننده</option>
                    <option value="Typ_DA_KA">تامین از دریافت کننده</option>
                    <option value="Typ_DA_TAN_Riy">تنخواه گردان ریالی</option>
                </select>
            </div>
            <div class="form-group">
                <label>طرف حساب: </label>
                <select asp-for="ReceiptSheet.PartnerId" class="form-select">
                    <option value="0">لطفا یک طرف حساب را انتخاب کنید</option>
                    @foreach (var partner in Model.Partners)
                    {
                        <option value="@partner.ID_tbl_TarafHesab">@partner.Name_TarafHesab</option>
                    }
                </select>
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                    <div class="form-group p-1">
                        <label>تاریخ: </label>
                        <input asp-for="ReceiptSheet.Date" class="form-control" data-jdp data-jdp-max-date="today" />
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                    <div class="form-group p-1">
                        <label>شرح: </label>
                        <textarea class="form-control" asp-for="ReceiptSheet.Description" placeholder="شرح رسید دریافت">
                        </textarea>
                    </div>
                </div>
            </div>

            <hr />

            <div class="text-danger" asp-validation-summary="All"></div>

            <button type="submit" class="btn btn-warning">ثبت نهایی دریافت</button>
        </form>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-3 col-md-3 col-sm-12 col-12 p-2">
            <div class="row">
                <div class="col-12 mb-2">
                    <button type="button" class="btn btn-primary" onclick="LunchCashDeskModal()">ثبت دریافت به صندوق</button>
                </div>
                <div class="col-12 mb-2">
                    <button type="button" class="btn btn-primary" onclick="LunchAddCheckModal()">ثبت دریاقت چک</button>
                </div>
                <div class="col-12 mb-2">
                    <button type="button" class="btn btn-primary" onclick="LunchReceiveFromPosMachine()">ثبت دریافت از کارتخوان</button>
                </div>
                <div class="col-12 mb-2">
                    <button type="button" class="btn btn-primary" onclick="LunchAddRemittanceModal()">ثبت دریافت حواله</button>
                </div>
            </div>
        </div>
        <div class="col-lg-9 col-md-9 col-sm-12 col-12 p-2">
            <div class="p-1" id="cash-desk"></div>
            <br />
            <div class="p-1" id="checks"></div>
            <br />
            <div class="p-1" id="card-receives"></div>
            <br />
            <div class="p-1" id="remittances"></div>
        </div>

    </div>
</div>


@*<div class="fixed-bottom w-full" style=" height: 4rem; background-color: white; border-top: 1px solid rgb(163, 163, 163)">
    <div class="w-full d-flex justify-content-center" style="height: 100%; align-items: center;">

        <a class="btn btn-success" style="height: 60%; width:80%;" asp-page="/ReceiptSheet/AddReceiptSheet">ثبت رسید دریافت</a>

    </div>
</div>*@

<div class="modal fade" id="Modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="modal-title"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal-body">
            </div>
            <div class="modal-footer">
                <sub>نرم افزار حسابداری سایسان</sub>
            </div>
        </div>
    </div>
</div>


@section Script
{
    <script>
        $(document).ready(async function () {
            await $.get("/ReceiptSheet/CashDesk/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#cash-desk").html(result);
            });

            await $.get("/ReceiptSheet/Check/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#checks").html(result);
            });

            await $.get("/ReceiptSheet/PosMachine/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#card-receives").html(result);
            });

            await $.get("/ReceiptSheet/Remittances/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#remittances").html(result);
            });
        });


        // Add Remittance

        async function LunchAddRemittanceModal() {
            $.get("/ReceiptSheet/Remittances/AddRemittance/@Model.ReceiptSheet.SessionId", function (result) {
                $("#modal-title").html('دریافت از طریق حواله');
                $("#modal-body").html(result);
                $("#Modal").modal('show');
            });
        }

        async function SubmitRemittanceForm() {

            if ($("#RemmitanceInput_BankAccountId").val() == -1 || $("#RemmitanceInput_BankAccountId").val() == null) {
                alert("لطفا یک حساب بانکی را انتخاب نمایید.");
                return;
            }

            if ($("#RemmitanceInput_Price").val() < 1 || $("#RemmitanceInput_Price").val() == null) {
                alert('لطفا مبلغ دریافتی را مشخص نمایید.');
                return;
            }

            $("#AddRemittance-Form").bind("submit", function () { return false; });

            await $.post("/ReceiptSheet/Remittances/AddRemittance/@Model.ReceiptSheet.SessionId", $("#AddRemittance-Form").serialize());

            await $.get("/ReceiptSheet/Remittances/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#remittances").html(result);
            });

            $("#Modal").modal('hide');
        }

        async function DeleteRemmitance(itemId) {
            await $.get("/ReceiptSheet/Remittances/DeleteRemmitance/" + itemId + "/@Model.ReceiptSheet.SessionId", function (result) {
                alert(result);
            });

            await $.get("/ReceiptSheet/Remittances/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#remittances").html(result);
            });
        }
        // End add remittance

        // Pos machine
        async function LunchReceiveFromPosMachine() {
            await $.get("/ReceiptSheet/PosMachine/AddPosReceive/@Model.ReceiptSheet.SessionId", function (result) {
                $("#modal-title").html('دریافت از کارتخوان');
                $("#modal-body").html(result);
                $("#Modal").modal('show');
            });
        }

        async function SubmitReceiveFromPosMachine() {
            if ($("#CardReader_BankAccountId").val() == -1 || $("#CardReader_BankAccountId").val() == null) {
                alert("لطفا یک حساب بانکی را انتخاب نمایید.");
                return;
            }

            if ($("#CardReader_Price").val() < 1 || $("#CardReader_Price").val() == null) {
                alert('لطفا مبلغ دریافتی را مشخص نمایید.');
                return;
            }

            $("#PosMachine-form").bind("submit", function () { return false; });

            await $.post("/ReceiptSheet/PosMachine/AddPosReceive/@Model.ReceiptSheet.SessionId", $("#PosMachine-form").serialize());

            await $.get("/ReceiptSheet/PosMachine/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#card-receives").html(result);
            });

            $("#Modal").modal('hide');
        }

        async function DeleteReceiveFromPosMachine(itemId) {
            await $.get("/ReceiptSheet/PosMachine/DeletePos/" + itemId + "/@Model.ReceiptSheet.SessionId", function (result) {
                alert(result);
            });

            await $.get("/ReceiptSheet/PosMachine/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#card-receives").html(result);
            });
        }
        // End pos Machine



        // Check
        async function LunchAddCheckModal() {
            await $.get("/ReceiptSheet/Check/AddCheck/@Model.ReceiptSheet.SessionId", function (result) {
                $("#modal-title").html('ثبت دریافت به چک');
                $("#modal-body").html(result);
                $('#Modal').modal('show');
            });
        }

        async function SubmitAddCheck() {
            if ($("#CheckDto_CheckNumber").val() == null || $("#CheckDto_CheckNumber").val() == 0) {
                alert("شماره چک نمیتواند خالی باشد.");
                return;
            }
            if ($("#CheckDto_CheckAmount").val() == null || $("#CheckDto_CheckAmount").val() == 0) {
                alert("مبلغ چک نمیتواند خالی باشد.");
                return;
            }
            if ($("#CheckDto_BehindTheCheckMark").val() == null || $("#CheckDto_BehindTheCheckMark").val() == 0) {
                alert("پشت نمره چک نمیتواند خالی باشد.");
                return;
            }
            if ($("#CheckDto_DuDate").val() == null || $("#CheckDto_DuDate").val() == "") {
                alert("تاریخ سر رسید چک نمیتواند خالی باشد.");
                return;
            }


            $("#add-check-form").bind("submit", function () { return false; });

            await $.post("/ReceiptSheet/Check/AddCheck/@Model.ReceiptSheet.SessionId", $("#add-check-form").serialize());

            await $.get("/ReceiptSheet/Check/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#checks").html(result);
            });

            $("#Modal").modal('hide');
        }

        async function DeleteCheck(itemId) {
            await $.get("/ReceiptSheet/Check/DeleteCheck/" + itemId + "/@Model.ReceiptSheet.SessionId", function (result) {
                alert(result);
            });

            await $.get("/ReceiptSheet/Check/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#checks").html(result);
            });

        }
        // End check



        // Cash desk
        async function LunchCashDeskModal() {
            await $.get("/ReceiptSheet/CashDesk/CashDeskForm/@Model.ReceiptSheet.SessionId", function (result) {
                $("#modal-title").html('ثبت دریافت به صندوق');
                $("#modal-body").html(result);
                $("#Modal").modal('show');
            });
        }

        async function SubmitCashDesk() {
            if ($("#FormInput_Price").val() == 0 || $("#FormInput_CashDeskId").val() == 0) {
                return;
            }

            $("#cash-desk-form").bind("submit", function () { return false; });

            await $.post("/ReceiptSheet/CashDesk/CashDeskForm/@Model.ReceiptSheet.SessionId", $("#cash-desk-form").serialize());

            await $.get("/ReceiptSheet/CashDesk/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#cash-desk").html(result);
            });

            $("#Modal").modal('hide');
        }

        async function DeleteCashDesk(itemId) {
            await $.get("/ReceiptSheet/CashDesk/DeleteCashDesk/" + itemId + "/@Model.ReceiptSheet.SessionId", function (result) {
                alert(result);

            });

            await $.get("/ReceiptSheet/CashDesk/Table/@Model.ReceiptSheet.SessionId", function (result) {
                $("#cash-desk").html(result);
            });
        }
        // End cash desk

    </script>
}